<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoonFuturo - Teste de Dados</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-medium: #161b22;
            --border-color: #30363d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-green: #238636;
            --accent-red: #da3633;
        }
        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background-color: var(--bg-medium);
            padding: 40px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            width: 100%;
            max-width: 800px;
        }
        .hidden { display: none; }
        h1 { text-align: center; margin-bottom: 30px; }
        .input-group { text-align: left; margin-bottom: 20px; }
        label { display: block; font-size: 0.9em; color: var(--text-secondary); margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 5px; background-color: var(--bg-dark); color: var(--text-primary); font-size: 1em; }
        button { width: 100%; padding: 15px; border: none; border-radius: 5px; background-color: var(--accent-green); color: white; font-weight: 600; font-size: 1em; cursor: pointer; }
        #login-message { margin-top: 20px; font-weight: 600; min-height: 20px; text-align: center; }

        #results-container { margin-top: 30px; }
        pre {
            background-color: var(--bg-dark);
            padding: 20px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Roboto Mono', monospace;
            color: var(--text-primary);
            max-height: 60vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="login-area">
            <h1>MoonFuturo - Teste de Dados</h1>
            <form id="login-form">
                <div class="input-group">
                    <label for="ra">Registro Acadêmico (RA):</label>
                    <input type="text" id="ra" name="ra" placeholder="Seu RA completo com dígito e UF" required>
                </div>
                <div class="input-group">
                    <label for="senha">Senha:</label>
                    <input type="password" id="senha" name="senha" placeholder="Sua senha da SED" required>
                </div>
                <button type="submit" id="login-button">Verificar Dados</button>
            </form>
            <div id="login-message"></div>
        </div>

        <div id="results-area" class="hidden">
            <h1 id="welcome-message"></h1>
            <div id="results-container">
                <h2>Dados Completos Recebidos do Servidor:</h2>
                <pre id="json-output"></pre>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginArea = document.getElementById('login-area');
            const resultsArea = document.getElementById('results-area');
            const loginForm = document.getElementById('login-form');
            const loginButton = document.getElementById('login-button');
            const loginMessage = document.getElementById('login-message');

            loginForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                loginButton.disabled = true;
                loginMessage.style.color = 'var(--text-secondary)';
                loginMessage.textContent = 'Buscando dados...';

                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user: document.getElementById('ra').value, senha: document.getElementById('senha').value }),
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error);

                    // Se deu tudo certo, exibe os resultados
                    loginArea.classList.add('hidden');
                    resultsArea.classList.remove('hidden');
                    
                    const userName = data.userInfo?.nome || 'Aluno(a)';
                    document.getElementById('welcome-message').textContent = `Dados para: ${userName}`;
                    document.getElementById('json-output').textContent = JSON.stringify(data, null, 2);

                } catch (error) {
                    loginMessage.style.color = 'var(--accent-red)';
                    loginMessage.textContent = `Erro: ${error.message}`;
                } finally {
                    loginButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>

