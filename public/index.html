<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bests.IA</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color:#f0f2f5; --card-bg:#ffffff; --text-color:#1c1e21; --secondary-text:#606770; --accent-color:#1877f2; --border-color:#dddfe2; --accent-red:#fa383e; --accent-green:#00a400; --accent-orange: #f7b928; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { background-color:var(--bg-color); color:var(--text-color); font-family:'Poppins', sans-serif; }
        .hidden { display:none!important; }

        #login-screen { display:flex; justify-content:center; align-items:center; height:100vh; padding:15px; }
        .login-container { background-color:var(--card-bg); padding:30px; border-radius:10px; width:100%; max-width:400px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
        .login-container h1 { margin-bottom:25px; }
        .input-group input { width:100%; padding:14px; margin-bottom:15px; border:1px solid var(--border-color); border-radius:8px; font-size:1em; }
        .login-container button { width:100%; padding:14px; border:none; border-radius:8px; background-color:var(--accent-color); color:white; font-weight:600; cursor:pointer; }
        #login-message-wrapper { margin-top:20px; min-height:22px; }
        #login-message { font-weight:500; }
        .save-login-wrapper { margin-top:15px; color:var(--secondary-text); }

        #dashboard-screen { display:flex; flex-direction:column; height:100vh; }
        .main-header { display:flex; align-items:center; padding:15px; background-color:var(--card-bg); border-bottom:1px solid var(--border-color); }
        #hamburger-btn { background:none; border:none; font-size:1.5em; cursor:pointer; margin-right:15px; }
        .sidebar { position:fixed; top:0; left:-100%; width:250px; height:100%; background-color:var(--card-bg); padding:20px; z-index:1001; transition:left 0.3s ease; border-right:1px solid var(--border-color); }
        .sidebar.is-open { left:0; }
        .main-content { flex-grow:1; padding:20px; overflow-y:auto; }
        .cards-container { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px; }
        .dashboard-card { background-color:var(--card-bg); border-left:5px solid; border-radius:8px; padding:20px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.05); }
        .card-title { font-size:1em; color:var(--secondary-text); }
        .card-data { font-size:2.5em; font-weight:700; color:var(--text-color); }

        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; z-index:1002; opacity:0; pointer-events:none; }
        .modal-overlay.is-visible { opacity:1; pointer-events:all; }
        .modal-content { background-color:var(--card-bg); padding:20px; border-radius:8px; width:95%; max-width:700px; max-height:85vh; overflow-y:auto; }
        .modal-close { float:right; background:none; border:none; font-size:1.5em; cursor:pointer; }
        .list-item { list-style:none; padding:15px; border-bottom:1px solid var(--border-color); }
        .list-item:hover { background-color:var(--bg-color); }
        .list-item h3 { margin-bottom:5px; }
        .list-item p { color:var(--secondary-text); }
        .question { margin:20px 0; }
        .question-option label { display:block; padding:10px; margin-bottom:8px; border-radius:5px; border:1px solid var(--border-color); }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="login-container"><h1>Bests.IA</h1><form id="login-form"><div class="input-group"><input type="text" id="ra" placeholder="RA com dígito e UF" required></div><div class="input-group"><input type="password" id="senha" placeholder="Senha da SED" required></div><button type="submit" id="login-button">Entrar</button></form><div id="login-message-wrapper"><div id="login-message"></div></div><div class="save-login-wrapper"><label><input type="checkbox" id="save-login-checkbox"> Salvar Login</label></div></div>
    </div>
    <div id="dashboard-screen" class="hidden">
        <header class="main-header"><button id="hamburger-btn">☰</button><h1 id="header-title">Bests.IA</h1></header>
        <nav id="sidebar" class="sidebar"><div id="user-profile"><h2 id="welcome-message"></h2><p id="school-name"></p></div></nav>
        <main id="main-content" class="main-content">
            <div class="cards-container">
                <div class="dashboard-card" data-modal-target="faltas-modal" style="border-color: #ffc107;"><div class="card-title">Faltas no Bimestre</div><div class="card-data" id="faltas-count">0</div></div>
                <div class="dashboard-card" data-modal-target="tarefas-modal" style="border-color: #1877f2;"><div class="card-title">Tarefas Pendentes</div><div class="card-data" id="tarefas-count">0</div></div>
                <div class="dashboard-card" data-modal-target="redacoes-modal" style="border-color: #6f42c1;"><div class="card-title">Redações</div><div class="card-data" id="redacoes-count">0</div></div>
                <div class="dashboard-card" data-modal-target="conquistas-modal" style="border-color: #f7b928;"><div class="card-title">Conquistas</div><div class="card-data" id="conquistas-count">0</div></div>
                <div class="dashboard-card" data-modal-target="notificacoes-modal" style="border-color: #fd7e14;"><div class="card-title">Notificações</div><div class="card-data" id="notificacoes-count">0</div></div>
            </div>
        </main>
    </div>
    
    <div id="faltas-modal" class="modal-overlay"><div class="modal-content"><button class="modal-close">&times;</button><h2>Faltas</h2><ul class="modal-list" id="faltas-list"></ul></div></div>
    <div id="tarefas-modal" class="modal-overlay"><div class="modal-content"><button class="modal-close">&times;</button><h2>Tarefas</h2><ul class="modal-list" id="tarefas-list"></ul></div></div>
    <div id="redacoes-modal" class="modal-overlay"><div class="modal-content"><button class="modal-close">&times;</button><h2>Redações</h2><ul class="modal-list" id="redacoes-list"></ul></div></div>
    <div id="conquistas-modal" class="modal-overlay"><div class="modal-content"><button class="modal-close">&times;</button><h2>Conquistas</h2><ul class="modal-list" id="conquistas-list"></ul></div></div>
    <div id="notificacoes-modal" class="modal-overlay"><div class="modal-content"><button class="modal-close">&times;</button><h2>Notificações</h2><ul class="modal-list" id="notificacoes-list"></ul></div></div>
    <div id="task-viewer-modal" class="modal-overlay"><div class="modal-content"><button class="modal-close">&times;</button><h2 id="task-viewer-title"></h2><form id="task-form"><div id="task-viewer-content"></div><button type="submit">Enviar Respostas</button></form></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let fullData = {};
            // ... (resto do script)
            const performLogin = async (ra, senha) => {
                // ... (lógica de login)
            };

            // Auto-login, etc.

            // FUNÇÕES DO DASHBOARD
            function populateDashboard() {
                const userName = fullData.userInfo?.NOME_COMPLETO || fullData.userInfo?.NAME || fullData.userInfo?.NOME || 'Aluno(a)';
                const firstName = userName.split(' ')[0];
                document.getElementById('welcome-message').textContent = `Bem-vindo(a), ${firstName}!`;
                document.getElementById('school-name').textContent = fullData.userInfo?.NOME_ESCOLA || 'Escola não encontrada';
                
                document.getElementById('faltas-count').textContent = fullData.faltas?.length || 0;
                document.getElementById('tarefas-count').textContent = (fullData.tarefas || []).filter(t => t.status !== 'expired' && t.answer?.status !== 'submitted').length;
                document.getElementById('redacoes-count').textContent = fullData.redacoes?.length || 0;
                document.getElementById('conquistas-count').textContent = fullData.conquistas?.length || 0;
                document.getElementById('notificacoes-count').textContent = fullData.notificacoes?.length || 0;
            }

            function showModal(modalId) {
                if (!modalId) return;
                const modal = document.getElementById(modalId);
                let content = '<p style="padding: 15px;">Nenhuma informação encontrada.</p>';
                
                try {
                    const list = modal.querySelector('.modal-list');
                    switch(modalId) {
                        case 'faltas-modal':
                            if (fullData.faltas?.length > 0) content = fullData.faltas.map(item => `<li class="list-item"><h3>${item.disciplina}</h3><p>Faltas: ${item.numeroFaltas}</p></li>`).join('');
                            break;
                        case 'tarefas-modal':
                        case 'redacoes-modal':
                            const source = modalId === 'tarefas-modal' ? fullData.tarefas : fullData.redacoes;
                            if (source?.length > 0) content = source.map(item => `<li class="list-item" onclick="openTaskViewer(${item.id}, '${item.publication_target}')"><h3>${item.title}</h3><p>Status: ${item.status === 'expired' ? 'Expirada' : (item.answer?.status === 'submitted' ? 'Entregue' : 'Pendente')}</p></li>`).join('');
                            break;
                        case 'conquistas-modal':
                            if (fullData.conquistas?.length > 0) content = fullData.conquistas.map(item => `<li class="list-item"><h3>${item.projeto}</h3><p>Medalha: ${item.medalha}</p></li>`).join('');
                            break;
                        case 'notificacoes-modal':
                            if (fullData.notificacoes?.length > 0) content = fullData.notificacoes.map(item => `<li class="list-item"><h3>${item.seesp_titulo}</h3><p>${item.seesp_mensagem}</p></li>`).join('');
                            break;
                    }
                    if(list) list.innerHTML = content;
                } catch(e) { console.error("Erro ao popular modal:", e); }
                modal.classList.add('is-visible');
            }
            // ... (resto das funções de modal e tasks)
        });
    </script>
</body>
        </html>
    
